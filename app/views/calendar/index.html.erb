<h1>Calendar#index</h1>
<div id='calendar' style='margin:3em 0;font-size:13px'></div>
<p>Find me in app/views/calendar/index.html.erb</p>

<script type="text/javascript">


setInterval(
     function(){
          $.ajax({
                type: "GET",
                url: "/event/next_event",
                datatype:"json",
                success: function(data){
                  jQuery.each( data, function( i, val ) {
                                    alert(val.event_name+" In 15 minutes");
                                });
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                  values = "";
                              jQuery.each( XMLHttpRequest, function( i, val ) {
                                    values = values + val+"\n"
                                });
                              alert(values);
                              return false;
                          }

              });
     },
     60000  /* 10000 ms = 10 sec */
);

function getTime(unix_timestamp)
{
     var a = new Date(unix_timestamp);
     var year = a.getFullYear();
     var month = a.getMonth()+1;
     var date = a.getDate();
     var hour = a.getHours();
     var min = a.getMinutes();
     var sec = a.getSeconds();
     if(month < 10){
      month = '0'+month
     }
     if(date < 10){
      date = '0'+date
     }
     if(hour < 10){
      hour = '0'+hour
     }
     var time = parseInt(year)+'-'+month+'-'+parseInt(date)+' '+hour+':'+min+':'+sec ;
     return time;

}
$(document).ready(function() {

     var today = new Date();
     var yyyy = today.getFullYear();
     var mm = today.getMonth()+1;
     var dd = today.getDate();
     if(mm < 10){
      mm = '0'+mm
     }
     if(dd < 10){
      dd = '0'+dd
     }
     today_date = yyyy+'-'+mm+'-'+dd

    var calendar = $('#calendar').fullCalendar({
      eventSources: [

        // your event source
        {
            url: '/event/',
            type: 'GET',
            error: function() {
                alert('there was an error while fetching events!');
            },
            color: 'yellow',   // a non-ajax option
            backgroundColor : "#1FCB4A",
            textColor: 'black' // a non-ajax option
        }

        // any other sources...

    ],
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,agendaWeek,agendaDay'
      },
      eventRender: function(event, element) {
            element.attr('title', event.tip);
        },
      defaultView: 'month',
      defaultDate: today_date,
      editable: true,
      selectable: true,
      selectHelper: true,

        select: function(start, end, allDay)
        {
          /*
            after selection user will be promted for enter title for event.
          */
          var title = prompt('Event Title:');
          /*
            if title is enterd calendar will add title and event into fullCalendar.
          */
          if (title)
          {
            calendar.fullCalendar('renderEvent',
              {
                title: title,
                start: start,
                end: end
              },
              true // make the event "stick"
            );
            var offset = new Date().getTimezoneOffset();
            var start_date = getTime(start+18000000)
            var end_date = getTime(end+18000000)
            dataList = "event_name="+title+"&start_date='"+start_date+"'&end_date='"+end_date
            var indexes = ""
            var values = ""
            jQuery.each( allDay, function( i, val ) {
              if(i == "buttons"){
                indexes = indexes + i+"\n"
                values = values + val+"\n"
              }
            });
            $.ajax({
                type: "POST",
                url: "/event/",
                data:dataList,
                datatype:"json",
                success: function(data){
                  alert(data.operation);
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                              jQuery.each( XMLHttpRequest, function( i, val ) {
                                    indexes = indexes + i+"\n"
                                    values = values + val+"\n"
                                });
                              alert(values);
                              return false;
                          }

              });
          }
          calendar.fullCalendar('unselect');
        },
        buttonText: {
          month: 'month',
          today: 'today'
      },
        axisFormat: 'H(:mm)', //,'h(:mm)tt',
        timeFormat: {
            agenda: 'H(:mm)' //h:mm{ - h:mm}'
            },
      //events: [loaded_events_string]
    });

  });
</script>


